<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Капля металла</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: #000;
            touch-action: none;
        }
        #canvas { 
            display: block; 
            width: 100vw; 
            height: 100vh; 
        }
        #error {
            position: fixed;
            top: 10px;
            left: 10px;
            color: red;
            background: rgba(0,0,0,0.8);
            padding: 8px;
            font-family: Arial;
            font-size: 14px;
            display: none;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="error"></div>

    <script>
        (function() {
            const errorEl = document.getElementById('error');
            
            function showError(msg) {
                if (errorEl) {
                    errorEl.style.display = 'block';
                    errorEl.textContent = msg;
                }
                console.error(msg);
                alert(msg); // Дублируем в alert для мобильных
            }

            // 1. Проверка WebGL
            if (!window.WebGLRenderingContext) {
                showError("Ваш браузер не поддерживает WebGL");
                return;
            }

            // 2. Проверка Three.js
            if (!window.THREE) {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
                script.onload = init;
                script.onerror = () => showError("Ошибка загрузки Three.js");
                document.head.appendChild(script);
                return;
            }

            init();

            function init() {
                try {
                    // 3. Базовая настройка сцены
                    const canvas = document.getElementById('canvas');
                    const renderer = new THREE.WebGLRenderer({
                        canvas: canvas,
                        antialias: true,
                        powerPreference: "low-power" // Для мобильных
                    });
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    renderer.setPixelRatio(Math.min(2, window.devicePixelRatio));

                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
                    camera.position.z = 5;

                    // 4. Создаем каплю (сфера + деформация)
                    const geometry = new THREE.SphereGeometry(1, 32, 32);
                    
                    // Деформируем сферу, чтобы была похожа на каплю
                    const position = geometry.attributes.position;
                    for (let i = 0; i < position.count; i++) {
                        const x = position.getX(i);
                        const y = position.getY(i);
                        const z = position.getZ(i);
                        
                        // Делаем "каплевидную" форму
                        const deformY = y > 0 ? y * 1.5 : y * 0.8;
                        position.setY(i, deformY);
                    }
                    
                    const material = new THREE.MeshPhysicalMaterial({
                        color: 0xaaaaaa,
                        metalness: 1.0,
                        roughness: 0.2,
                        clearcoat: 0.8,
                        envMapIntensity: 1.0
                    });

                    const drop = new THREE.Mesh(geometry, material);
                    scene.add(drop);

                    // 5. Простое освещение
                    const light1 = new THREE.DirectionalLight(0xffffff, 1);
                    light1.position.set(1, 1, 1);
                    scene.add(light1);

                    const light2 = new THREE.AmbientLight(0x404040);
                    scene.add(light2);

                    // 6. Анимация капли
                    let time = 0;
                    function animate() {
                        requestAnimationFrame(animate);
                        
                        // Плавное покачивание
                        time += 0.01;
                        drop.rotation.x = Math.sin(time * 0.7) * 0.2;
                        drop.rotation.y = time * 0.3;
                        
                        // Легкая пульсация
                        const scale = 1 + Math.sin(time * 1.5) * 0.05;
                        drop.scale.set(scale, scale, scale);
                        
                        renderer.render(scene, camera);
                    }

                    // 7. Обработка ресайза
                    window.addEventListener('resize', () => {
                        camera.aspect = window.innerWidth / window.innerHeight;
                        camera.updateProjectionMatrix();
                        renderer.setSize(window.innerWidth, window.innerHeight);
                    });

                    animate();

                } catch (e) {
                    showError("Ошибка: " + e.message);
                }
            }
        })();
    </script>
</body>
</html>
